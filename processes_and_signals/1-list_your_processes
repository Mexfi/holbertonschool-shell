#!/usr/bin/env bash
# This script displays a list of currently running processes in a hierarchical format.
# It shows all processes for all users, including those without a TTY.

# Use ps with the -axjf options for a full, hierarchical listing.
# -a: Display processes of all users.
# -x: Display processes without a controlling tty.
# -j: Jobs format, which includes PPID for hierarchy.
# -f: Full format listing.
# The `pstree` command could also be used for a purely tree-like view,
# but `ps -axjf` provides more detailed information in a hierarchical layout.

# The output is then formatted to include the desired columns:
# USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND
ps -axjf | awk '
BEGIN {
    # Print the header line
    printf "%-8s %-6s %-5s %-5s %-7s %-6s %-4s %-4s %-5s %-8s %s\n", \
           "USER", "PID", "%CPU", "%MEM", "VSZ", "RSS", "TTY", "STAT", "START", "TIME", "COMMAND"
}
NR > 1 {
    # Extract relevant fields and format them
    # Uid, Pid, Ppid, C, Stime, Tty, Time, Cmd
    # We need to map these to the desired output fields:
    # USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND

    # For hierarchical display, we need to indent the COMMAND based on PPID.
    # ps -axjf output already provides a good structure for this.
    # The 'ps -axjf' output's 'CMD' column already shows the hierarchy with '\_'.
    # We just need to ensure the other columns align correctly.

    # Reconstruct the line based on the ps -axjf output structure
    # $1=USER, $2=PID, $3=PPID, $4=C, $5=STIME, $6=TTY, $7=TIME, $8=CMD_START
    # The remaining fields from $8 onwards form the COMMAND.
    # %CPU, %MEM, VSZ, RSS are not directly in ps -axjf's default output,
    # so we need to use a different ps format or calculate them.
    # The example output matches 'ps auxf' more closely for these fields.

    # Let's use 'ps auxf' for the desired columns and hierarchical view.
    # 'ps auxf' gives the tree structure in the COMMAND column and also provides
    # %CPU, %MEM, VSZ, RSS.

    # Re-evaluating based on the example provided:
    # The example output format is exactly what 'ps auxf' provides.
    # The '\_' characters in the COMMAND column indicate the process hierarchy.
    # We just need to ensure the header matches.
    
    # We are already using ps auxf in the final command below.
    # This awk block is for illustrative purposes if further parsing were needed.
    # Since ps auxf directly provides the desired format, a simple header print is enough.
}
'

# The core command to achieve the desired output:
# ps auxf:
# -a: all users
# -u: user-oriented format (includes USER, PID, %CPU, %MEM, VSZ, RSS, TTY, STAT, START, TIME, COMMAND)
# -x: processes without controlling TTYs
# -f: ASCII art process hierarchy (forest)
ps auxf
